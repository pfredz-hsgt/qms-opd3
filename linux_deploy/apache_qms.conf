<VirtualHost *:80>
    ServerName qms.yourdomain.com
    # ServerAdmin webmaster@localhost

    # Enable modules: proxy, proxy_http, proxy_wstunnel, rewrite
    # sudo a2enmod proxy proxy_http proxy_wstunnel rewrite

    # Proxy to Gunicorn
    ProxyPreserveHost On

    # Static files
    Alias /static /opt/qms-opd/static
    <Directory /opt/qms-opd/static>
        Require all granted
    </Directory>

    # WebSocket Support (Socket.IO)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://127.0.0.1:8000/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://127.0.0.1:8000/$1 [P,L]

    # Fallback Proxy
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    ErrorLog ${APACHE_LOG_DIR}/qms_error.log
    CustomLog ${APACHE_LOG_DIR}/qms_access.log combined
</VirtualHost>
